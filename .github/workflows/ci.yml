name: CI - Push

on:
  push:
    branches: ["main"]
  workflow_dispatch:

jobs:
  swiftpm:
    name: Build SwiftPM
    runs-on: macOS-14
    strategy:
        matrix:
          packages: [OversizeComponents]

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Set secret
        run: git config --global url."https://${{ secrets.ACTIONS_TOKEN }}:x-oauth-basic@github.com/".insteadOf "https://github.com/"

      
      - name: Set pipefail
        run: set -euo pipefail

      - name: Set SwiftPM Plugin config
        run: defaults write com.apple.dt.Xcode IDESkipPackagePluginFingerprintValidatation -bool YES
        
      - name: Build
        run: xcodebuild clean build -skipPackagePluginValidation -scheme ${{ matrix.packages }} -destination 'platform=iOS Simulator,name=iPhone 8,OS=16.4' | xcpretty && exit ${PIPESTATUS[0]}

#   build-oversizeComponents:
#     name: Build OversizeComponents
#     uses: oversizedev/GithubWorkflows/.github/workflows/build-swiftpm.yml@main
#     with:
#       package: "OversizeComponents"
#     secrets: inherit
    
#   build-healthComponents:
#     name: Build HealthComponents
#     uses: oversizedev/GithubWorkflows/.github/workflows/build-swiftpm.yml@main
#     with:
#       package: "OversizeHealthComponents"
#     secrets: inherit
    
#   build-photoComponents:
#     name: Build PhotoComponents
#     uses: oversizedev/GithubWorkflows/.github/workflows/build-swiftpm.yml@main
#     with:
#       package: "OversizePhotoComponents"
#     secrets: inherit
    
#   build-weatherComponents:
#     name: Build WeatherComponents
#     uses: oversizedev/GithubWorkflows/.github/workflows/build-swiftpm.yml@main
#     with:
#       package: "OversizeWeatherComponents"
#     secrets: inherit
    
#   tests:
#     name: Test
#     needs: [build-oversizeComponents, build-healthComponents, build-photoComponents, build-weatherComponents]
#     uses: oversizedev/GithubWorkflows/.github/workflows/test.yml@main
#     secrets: inherit
    
#   bump:
#     name: Bump version
#     needs: tests
#     uses: oversizedev/GithubWorkflows/.github/workflows/bump.yml@main
#     secrets: inherit
